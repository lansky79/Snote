<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>帮助 - 源踔科技集成产品开发管理系统</title>
    <link rel="stylesheet" href="css/common.css" />
  </head>
  <body>
    <!-- 左侧导航栏 -->
    <nav class="sidebar">
      <div class="sidebar-header">
        <div class="system-title">
          <div class="company-name">源踔科技</div>
          <div class="system-name">集成产品开发管理系统</div>
        </div>
      </div>
      <div class="nav-menu">
        <a href="index.html">项目概览</a>
        <a href="dashboard.html">数据分析</a>
        <a href="team.html">团队协作</a>
        <a href="stages.html">阶段管理</a>
        <a href="dcp.html">DCP评审</a>
        <a href="deliverables.html">交付物管理</a>
        <a href="reports.html">报表中心</a>
        <a href="users.html">用户管理</a>
        <a href="help.html">帮助中心</a>
        <a href="settings.html">系统设置</a>
        <a href="#" onclick="logout()" class="logout">退出</a>
      </div>
    </nav>

    <!-- 主要内容区域 -->
    <main class="main-content">
      <!-- 搜索框 -->
      <div class="card" style="margin-bottom: 30px">
        <div class="card-content">
          <div style="display: flex; gap: 15px; align-items: center">
            <input
              type="text"
              id="help-search"
              placeholder="搜索帮助内容..."
              style="
                flex: 1;
                padding: 12px 15px;
                border: 1px solid #ddd;
                border-radius: 6px;
                font-size: 1rem;
              "
              onkeyup="searchHelp()"
            />
            <button
              class="btn btn-primary"
              onclick="searchHelp()"
              style="padding: 12px 20px"
            >
              搜索
            </button>
          </div>
        </div>
      </div>

      <!-- 帮助内容 -->
      <div style="display: grid; grid-template-columns: 250px 1fr; gap: 30px">
        <!-- 侧边导航 -->
        <div class="card" style="height: fit-content">
          <div class="card-content" style="padding: 0">
            <div id="help-categories">
              <!-- 帮助分类将通过JavaScript动态生成 -->
            </div>
          </div>
        </div>

        <!-- 内容区域 -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title" id="content-title">快速入门</h3>
          </div>
          <div class="card-content">
            <div id="help-content">
              <!-- 帮助内容将通过JavaScript动态生成 -->
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- 引入脚本 -->
    <script src="js/data.js"></script>
    <script src="js/common.js"></script>
    <script>
      // 帮助内容数据
      var helpData = {
        quickStart: {
          name: "快速入门",
          icon: "🚀",
          content: `
            <h4>欢迎使用源踔科技集成产品开发管理系统</h4>
            <p>本系统基于IPD（集成产品开发）流程设计，帮助企业高效管理产品开发项目。</p>
            
            <h5>系统概述</h5>
            <p>IPD系统包含六个核心阶段：概念、计划、开发、验证、发布、生命周期。每个阶段都有相应的决策检查点（DCP）来确保项目质量。</p>
            
            <h5>登录系统</h5>
            <ol>
              <li>访问系统登录页面</li>
              <li>输入用户名和密码</li>
              <li>点击"登录系统"按钮</li>
              <li>成功登录后将跳转到项目概览页面</li>
            </ol>
            
            <h5>主要功能模块</h5>
            <ul>
              <li><strong>项目概览</strong>：查看所有项目的整体情况</li>
              <li><strong>仪表板</strong>：数据分析和可视化展示</li>
              <li><strong>团队协作</strong>：团队成员管理和协作</li>
              <li><strong>阶段管理</strong>：IPD六阶段流程管理</li>
              <li><strong>DCP评审</strong>：决策检查点评审流程</li>
              <li><strong>交付物管理</strong>：项目交付物上传和管理</li>
              <li><strong>报表中心</strong>：各类报表生成和导出</li>
              <li><strong>用户管理</strong>：系统用户信息管理</li>
            </ul>
          `,
        },
        userGuide: {
          name: "用户指南",
          icon: "📖",
          content: `
            <h4>详细使用指南</h4>
            
            <h5>项目管理</h5>
            <p>在项目概览页面，您可以：</p>
            <ul>
              <li>查看所有项目的状态和进度</li>
              <li>创建新的项目</li>
              <li>编辑现有项目信息</li>
              <li>查看项目详细信息</li>
            </ul>
            
            <h5>阶段管理</h5>
            <p>IPD六阶段管理功能：</p>
            <ol>
              <li><strong>概念阶段</strong>：确定产品概念和市场需求</li>
              <li><strong>计划阶段</strong>：制定详细的项目计划</li>
              <li><strong>开发阶段</strong>：进行产品开发和实现</li>
              <li><strong>验证阶段</strong>：对产品进行全面验证</li>
              <li><strong>发布阶段</strong>：产品发布和部署</li>
              <li><strong>生命周期阶段</strong>：产品生命周期管理</li>
            </ol>
            
            <h5>DCP评审流程</h5>
            <p>决策检查点评审是IPD流程的核心：</p>
            <ul>
              <li>每个阶段结束时需要进行DCP评审</li>
              <li>评审通过后才能进入下一阶段</li>
              <li>评审员需要对项目进行全面评估</li>
              <li>评审结果包括：通过、有条件通过、不通过</li>
            </ul>
            
            <h5>交付物管理</h5>
            <p>管理项目相关的所有交付物：</p>
            <ul>
              <li>上传项目文档、设计图、代码等</li>
              <li>版本控制和历史记录</li>
              <li>审批流程管理</li>
              <li>下载和分享功能</li>
            </ul>
          `,
        },
        faq: {
          name: "常见问题",
          icon: "❓",
          content: `
            <h4>常见问题解答</h4>
            
            <div style="margin-bottom: 25px;">
              <h5>Q: 忘记密码怎么办？</h5>
              <p>A: 请联系系统管理员重置密码，或使用登录页面的"找回密码"功能。</p>
            </div>
            
            <div style="margin-bottom: 25px;">
              <h5>Q: 如何创建新项目？</h5>
              <p>A: 在项目概览页面点击"创建项目"按钮，填写项目基本信息即可创建。</p>
            </div>
            
            <div style="margin-bottom: 25px;">
              <h5>Q: DCP评审需要多长时间？</h5>
              <p>A: 评审时间取决于项目复杂度和评审员数量，通常在3-7个工作日内完成。</p>
            </div>
            
            <div style="margin-bottom: 25px;">
              <h5>Q: 如何上传交付物？</h5>
              <p>A: 在交付物管理页面点击"上传交付物"按钮，选择文件并填写相关信息。</p>
            </div>
            
            <div style="margin-bottom: 25px;">
              <h5>Q: 报表可以导出哪些格式？</h5>
              <p>A: 系统支持导出PDF和Excel两种格式的报表。</p>
            </div>
            
            <div style="margin-bottom: 25px;">
              <h5>Q: 如何查看项目进度？</h5>
              <p>A: 可以在项目概览、仪表板或阶段管理页面查看项目的详细进度信息。</p>
            </div>
            
            <div style="margin-bottom: 25px;">
              <h5>Q: 团队成员权限如何管理？</h5>
              <p>A: 在用户管理页面可以设置不同用户的角色和权限，包括项目经理、团队成员、评审员等。</p>
            </div>
            
            <div style="margin-bottom: 25px;">
              <h5>Q: 系统支持哪些浏览器？</h5>
              <p>A: 推荐使用Chrome、Firefox、Safari或Edge等现代浏览器的最新版本。</p>
            </div>
          `,
        },
        contact: {
          name: "联系支持",
          icon: "📞",
          content: `
            <h4>技术支持联系方式</h4>
            
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 30px;">
              <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
                <h5 style="color: #2c3e50; margin-bottom: 15px;">📧 邮件支持</h5>
                <p><strong>技术支持邮箱：</strong></p>
                <p>support@yuancho.com</p>
                <p><strong>响应时间：</strong> 24小时内回复</p>
              </div>
              
              <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
                <h5 style="color: #2c3e50; margin-bottom: 15px;">📞 电话支持</h5>
                <p><strong>技术支持热线：</strong></p>
                <p>400-123-4567</p>
                <p><strong>服务时间：</strong> 工作日 9:00-18:00</p>
              </div>
              
              <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
                <h5 style="color: #2c3e50; margin-bottom: 15px;">💬 在线客服</h5>
                <p><strong>QQ群：</strong> 123456789</p>
                <p><strong>微信群：</strong> 扫描二维码加入</p>
                <p><strong>服务时间：</strong> 工作日 9:00-18:00</p>
              </div>
              
              <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
                <h5 style="color: #2c3e50; margin-bottom: 15px;">🏢 公司地址</h5>
                <p><strong>源踔科技有限公司</strong></p>
                <p>北京市海淀区中关村大街123号</p>
                <p>科技大厦15层</p>
              </div>
            </div>
            
            <h5>提交问题反馈</h5>
            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
              <form onsubmit="submitFeedback(event)">
                <div style="margin-bottom: 15px;">
                  <label style="display: block; margin-bottom: 5px; font-weight: bold;">问题类型</label>
                  <select style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                    <option>功能问题</option>
                    <option>性能问题</option>
                    <option>界面问题</option>
                    <option>数据问题</option>
                    <option>其他问题</option>
                  </select>
                </div>
                
                <div style="margin-bottom: 15px;">
                  <label style="display: block; margin-bottom: 5px; font-weight: bold;">问题描述</label>
                  <textarea 
                    placeholder="请详细描述您遇到的问题..."
                    style="width: 100%; height: 100px; padding: 10px; border: 1px solid #ddd; border-radius: 4px; resize: vertical;"
                  ></textarea>
                </div>
                
                <div style="margin-bottom: 15px;">
                  <label style="display: block; margin-bottom: 5px; font-weight: bold;">联系方式</label>
                  <input 
                    type="text" 
                    placeholder="请输入您的邮箱或电话"
                    style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;"
                  />
                </div>
                
                <button type="submit" class="btn btn-primary">提交反馈</button>
              </form>
            </div>
            
            <div style="margin-top: 30px; padding: 15px; background: #e3f2fd; border-radius: 8px; border-left: 4px solid #2196f3;">
              <h6 style="color: #1976d2; margin-bottom: 10px;">💡 温馨提示</h6>
              <p style="margin: 0; color: #1976d2;">为了更好地为您服务，请在联系我们时提供详细的问题描述和相关截图。我们会尽快为您解决问题。</p>
            </div>
          `,
        },
      };

      // 当前显示的内容
      var currentCategory = "quickStart";

      // 渲染帮助分类
      function renderHelpCategories() {
        var container = document.getElementById("help-categories");
        var html = "";

        for (var key in helpData) {
          var category = helpData[key];
          var isActive = key === currentCategory;

          html +=
            '<div class="help-category ' +
            (isActive ? "active" : "") +
            '" onclick="showHelpContent(\'' +
            key +
            '\')" style="padding: 15px; cursor: pointer; border-bottom: 1px solid #e9ecef; display: flex; align-items: center; gap: 10px; transition: background-color 0.3s; ' +
            (isActive ? "background-color: #e3f2fd; color: #1976d2;" : "") +
            '">';
          html +=
            '<span style="font-size: 1.2em;">' + category.icon + "</span>";
          html += "<span>" + category.name + "</span>";
          html += "</div>";
        }

        container.innerHTML = html;
      }

      // 显示帮助内容
      function showHelpContent(categoryKey) {
        if (!helpData[categoryKey]) return;

        currentCategory = categoryKey;
        var category = helpData[categoryKey];

        document.getElementById("content-title").textContent = category.name;
        document.getElementById("help-content").innerHTML = category.content;

        renderHelpCategories(); // 重新渲染分类以更新选中状态
      }

      // 搜索帮助内容
      function searchHelp() {
        var searchTerm = document
          .getElementById("help-search")
          .value.toLowerCase()
          .trim();

        if (!searchTerm) {
          showHelpContent(currentCategory);
          return;
        }

        var results = [];
        for (var key in helpData) {
          var category = helpData[key];
          if (
            category.name.toLowerCase().includes(searchTerm) ||
            category.content.toLowerCase().includes(searchTerm)
          ) {
            results.push({
              key: key,
              category: category,
              relevance: calculateRelevance(category, searchTerm),
            });
          }
        }

        // 按相关性排序
        results.sort(function (a, b) {
          return b.relevance - a.relevance;
        });

        displaySearchResults(results, searchTerm);
      }

      // 计算搜索相关性
      function calculateRelevance(category, searchTerm) {
        var score = 0;
        var name = category.name.toLowerCase();
        var content = category.content.toLowerCase();

        // 标题匹配权重更高
        if (name.includes(searchTerm)) {
          score += 10;
        }

        // 内容匹配
        var matches = (content.match(new RegExp(searchTerm, "g")) || []).length;
        score += matches;

        return score;
      }

      // 显示搜索结果
      function displaySearchResults(results, searchTerm) {
        var contentTitle = document.getElementById("content-title");
        var contentArea = document.getElementById("help-content");

        if (results.length === 0) {
          contentTitle.textContent = "搜索结果";
          contentArea.innerHTML =
            '<div style="text-align: center; padding: 40px; color: #999;"><div style="font-size: 3em; margin-bottom: 15px;">🔍</div><div>未找到相关内容</div><div style="font-size: 0.9em; margin-top: 10px;">请尝试其他关键词</div></div>';
          return;
        }

        contentTitle.textContent = "搜索结果 (" + results.length + ")";
        var html = '<div style="margin-bottom: 20px;">';
        html +=
          '<div style="color: #666; font-size: 0.9em;">搜索关键词: <strong>' +
          searchTerm +
          "</strong></div>";
        html += "</div>";

        for (var i = 0; i < results.length; i++) {
          var result = results[i];
          var category = result.category;

          html +=
            '<div style="border: 1px solid #e9ecef; border-radius: 6px; padding: 20px; margin-bottom: 15px; cursor: pointer;" onclick="showHelpContent(\'' +
            result.key +
            "')\">";
          html +=
            '<div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">';
          html +=
            '<span style="font-size: 1.5em;">' + category.icon + "</span>";
          html +=
            '<h5 style="margin: 0; color: #2c3e50;">' + category.name + "</h5>";
          html += "</div>";

          // 显示内容预览
          var preview = category.content
            .replace(/<[^>]*>/g, "")
            .substring(0, 200);
          if (preview.length === 200) preview += "...";

          html +=
            '<p style="color: #666; margin: 0; line-height: 1.5;">' +
            preview +
            "</p>";
          html += "</div>";
        }

        contentArea.innerHTML = html;
      }

      // 提交反馈
      function submitFeedback(event) {
        event.preventDefault();
        showSuccessMessage("反馈提交成功！我们会尽快处理您的问题。");
      }

      // 页面初始化
      document.addEventListener("DOMContentLoaded", function () {
        // 检查登录状态
        if (sessionStorage.getItem("isLoggedIn") !== "true") {
          window.location.href = "login.html";
          return;
        }

        renderHelpCategories();
        showHelpContent("quickStart");
      });
    </script>
  </body>
</html>
